scalar Upload

# ###########################
#           TYPE
#############################

type User {
  # id: String
  email: String
  name: String
  c_date: DateTime
  role: UserRole
  verified: Boolean
}

type Page {
  id: Int
  permalink: String
  title: String
  content: String
  c_date: DateTime
  m_date: DateTime
  role: String
  belongs_to: String
  meta_json: JSON
}

type File {
  filename: String
  mimetype: String
  encoding: String
}

# SignInUserPayload bundles information about the user and token
type SignInUserPayload {
  user: User
  token: String
}

type CheckAuthResponse {
  permissionStatus: PermissionStatus
  user: User
}

type AuthPayload {
  user: User
  redirectLink: String
}

# ###########################
#           ENUMS
#############################

enum UserRole {
  ADMIN
  GUEST
}

enum PermissionStatus {
  OK
  LOGIN_REQUIRED
  NO_PERMISSION
}

enum Permission {
  ADMIN
  GUEST
  ANYONE
}

# ###########################
#           INPUT
#############################

input EmailAuthProvider {
  email: String
  pwd: String
}

input UserUpdateInfo {
  pwd: String
  name: String
  role: UserRole
}

input FileModInput {
  description: String
  label: String # 보여지는 이름
  alt: String
  public: Boolean
  managed: Boolean
}

input DatetimeInput {
  day: Int!
  month: Int!
  year: Int!
  hour: Int!
  minute: Int!
  second: Int!
}

input PageInput {
  title: String
  content: String
  permalink: String
  c_date: DateTime
  m_date: DateTime
  role: String
  belongs_to: String
  meta_json: JSON
}

# ###########################
#         QUARY
#############################

type Query {
  # uploads: [File]

  ## USER
  users: [User]
  user(email: String!): User
  currentUser: User
  getUserByEmailNoAuth(email: String!): User # MUST DELETE WHEN DEPLOY!
  ## PAGE
  page(permalink: String!, belongs_to: String!): Page
  pages(belongs_to: String!, page: Int, perpage: Int): [Page]
  pageById(id: Int!): Page
  checkAuth(redirectLink: String!, role: Permission!): CheckAuthResponse
  getFilesManaged: [File]
  getFileByFilename(filename: String!): File
}

extend type Query {
  hello: User
}
extend type Mutation {
  hello2: User
}

# ###########################
#         MUTATION
#############################

type Mutation {
  ## login and logout
  login(provider: EmailAuthProvider!, redirectLink: String): AuthPayload
  # logout(email: String!): AuthPayload
  logoutMe: User

  # createAdmin(email: String!, pwd: String!, role: UserRole!): User
  createGuest(email: String!, pwd: String!): User
  verifyUserEmail(token: String!): User
  updateUser(email: String!, userinfo: UserUpdateInfo): User

  # pages
  createPage(
    permalink: String!
    belongs_to: String!
    pageinfo: PageInput!
  ): Page
  updatePage(
    permalink: String!
    belongs_to: String!
    pageinfo: PageInput!
  ): Page
  removePage(permalink: String!, belongs_to: String!): Page

  # signin
  # signinUserByEmail(provider: EmailAuthProvider!): SignInUserPayload
  # singleUpload(file: Upload!): File!

  # 1. Create new user
  # createUser(authProvider: EmailAuthProvider!): User
  # createPage(title: String!, content: String!, author: String!, permalink: String!): Page
}
